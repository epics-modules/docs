<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ip330 Documentation &#8212; EPICS Modules 8041767 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon_t.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="measComp" href="../measComp/measComp.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          epics-modules</a>
        <span class="navbar-text navbar-version pull-left"><b>8041767</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Readme</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.aps.anl.gov/BCDA/synApps-license">License</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">synApps modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../dante/dante.html">Dante</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dante/dante.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dante/dante.html#dante-driver">Dante driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dante/dante.html#ioc-startup-script">IOC startup script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dante/dante.html#medm-screens">MEDM screens</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../measComp/measComp.html">measComp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../measComp/measComp.html#introduction">Introduction</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ip330 Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">ip330 Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">ip330 Documentation</a><ul>
<li><a class="reference internal" href="#id1">ip330 Documentation</a><ul>
<li><a class="reference internal" href="#mark-rivers">Mark Rivers</a></li>
<li><a class="reference internal" href="#release-2-9">Release 2-9</a></li>
<li><a class="reference internal" href="#class-ip330">Class Ip330</a><ul>
<li><a class="reference internal" href="#ip330-public-interface">Ip330 public interface</a></li>
<li><a class="reference internal" href="#ip330-configuration">Ip330 configuration</a></li>
<li><a class="reference internal" href="#ip330-hardware-setup">IP330 Hardware setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ip330config-server">Ip330Config Server</a><ul>
<li><a class="reference internal" href="#ip330config-server-configuration">Ip330Config server configuration</a></li>
<li><a class="reference internal" href="#ip330config-epics-device-support">Ip330Config EPICS Device Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#class-ip330scan">Class Ip330Scan</a><ul>
<li><a class="reference internal" href="#ip330scan-public-interface">Ip330Scan public interface</a></li>
<li><a class="reference internal" href="#ip330scan-configuration">Ip330Scan configuration</a></li>
<li><a class="reference internal" href="#ip330scan-epics-device-support">Ip330Scan EPICS Device Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#restrictions-on-scan-timing">Restrictions on Scan Timing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../measComp/measComp.html" title="Previous Chapter: measComp"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; measComp</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/ip330/ip330.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="ip330-documentation">
<h1><a class="toc-backref" href="#id2">ip330 Documentation</a><a class="headerlink" href="#ip330-documentation" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#ip330-documentation" id="id2">ip330 Documentation</a><ul>
<li><a class="reference internal" href="#id1" id="id3">ip330 Documentation</a><ul>
<li><a class="reference internal" href="#mark-rivers" id="id4">Mark Rivers</a></li>
<li><a class="reference internal" href="#release-2-9" id="id5">Release 2-9</a></li>
<li><a class="reference internal" href="#class-ip330" id="id6">Class Ip330</a></li>
<li><a class="reference internal" href="#ip330config-server" id="id7">Ip330Config Server</a></li>
<li><a class="reference internal" href="#class-ip330scan" id="id8">Class Ip330Scan</a></li>
<li><a class="reference internal" href="#restrictions-on-scan-timing" id="id9">Restrictions on Scan Timing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id3">ip330 Documentation</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mark-rivers">
<h3><a class="toc-backref" href="#id4">Mark Rivers</a><a class="headerlink" href="#mark-rivers" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="release-2-9">
<h3><a class="toc-backref" href="#id5">Release 2-9</a><a class="headerlink" href="#release-2-9" title="Permalink to this headline">¶</a></h3>
<p>This file describes support for the Acromag Ip300, a 16/32 channel,
16-bit A/D converter in the Industry Pack form factor. This support is a
C driver that is based on
<a class="reference external" href="http://www.aps.anl.gov/epics/modules/soft/asyn/">asyn</a>. It supports
both the asynInt32 and asynFloat64 interfaces. The asynInt32 interface
is used for ai records, and does callbacks to device support each time a
new value is read from the hardware. This can cause the ai record to
process on each callback. Alternatively the standard asyn Int32Average
device support can be used with periodic ai record scanning to average
the callback values that have happened since the last time the record
processed. The asynFloat64 is provided for use with the fast feedback in
the <a class="reference external" href="http://cars9.uchicago.edu/software/epics/epidRecord.html">EPID
record</a>,
which is part of the
<a class="reference external" href="http://www.aps.anl.gov/bcda/synApps/std/std.html">std</a> module in
<a class="reference external" href="http://www.aps.anl.gov/bcda/synApps/">synApps</a>. The asynInt32Array
interface is used to do callbacks to an MCA record to implement waveform
recorder/transient digitizer applications. All three modes (ai record,
mca record, epid record) can be running simultaneously, and can even all
be talking to the same input channels.</p>
<p>The driver uses the <a class="reference external" href="https://svn.aps.anl.gov/trac/epics/ipac">ipac
module</a> for Industry Pack
communication.</p>
</div>
<div class="section" id="class-ip330">
<h3><a class="toc-backref" href="#id6">Class Ip330</a><a class="headerlink" href="#class-ip330" title="Permalink to this headline">¶</a></h3>
<p>The only parameters of the IP330 module which are not configurable in
the driver are the output data format (which is set to Straight Binary)
and the Interrupt Control (which is set to interrupt after conversion of
all selected channels). All other parameters of the IP330 can be
configured (first and last channels to convert, scan mode, scan rate,
trigger signal direction, etc.) Currently all parameters except the time
between between calibrations. MPF servers and EPICS device support exist
for the application-specific classes which sit above Ip330.</p>
<div class="section" id="ip330-public-interface">
<h4>Ip330 public interface<a class="headerlink" href="#ip330-public-interface" title="Permalink to this headline">¶</a></h4>
<p>This is the public interface of the Ip330 class:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class Ip330
{
public:
    static Ip330 * init(
        const char *moduleName, const char *carrierName, const char *siteName,
        const char *type, const char *range, int firstChan, int lastChan,
        int maxClients, int intVec);
    int config(scanModeType scanMode, const char *triggerString, int
        microSecondsPerScan, int secondsBetweenCalibrate);
    int getCorrectedValue(int channel);
    int correctValue(int channel, int raw);
    int getRawValue(int channel);
    int setGain(int gain,int channel);
    int setScanMode(scanModeType scanMode);
    int setTrigger(triggerType trigger);
    float setMicroSecondsPerScan(float microSeconds);
    float getMicroSecondsPerScan();
    void setSecondsBetweenCalibrate(int seconds);
    int registerCallback(Ip330Callback callback, void *pvt);
</pre></div>
</div>
<p>Brief description of these functions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">init()</span></code> and <code class="docutils literal notranslate"><span class="pre">config()</span></code> are called from <code class="docutils literal notranslate"><span class="pre">initIp330</span></code> and
``       configIp330`` which are discussed below.</li>
<li><code class="docutils literal notranslate"><span class="pre">getRawValue()</span></code> returns the A/D value for a channel without
applying the calibration corrections for slope and offset.</li>
<li><code class="docutils literal notranslate"><span class="pre">getCorrectedValue()</span></code> returns the A/D value for a channel after
applying the calibration corrections for slope and offset. NOTE: If
secondsBetweenCalibrate is less than zero then the raw A/D value is
returned.</li>
<li><code class="docutils literal notranslate"><span class="pre">correctValue()</span></code> corrects an input raw value for a channel by
applying the calibration corrections for slope and offset. NOTE: If
secondsBetweenCalibrate is less than zero then the raw A/D value is
returned.</li>
<li><code class="docutils literal notranslate"><span class="pre">setGain()</span></code> sets the gain for a channel. The specified gain must be
{0, 1, 2, or 3} corresponding to gains of {1, 2, 4, 8}. At
initialization the gain of each channel is set to 0 and the channel
calibrated.</li>
<li><code class="docutils literal notranslate"><span class="pre">setScanMode()</span></code> sets the scan mode of the IP330. The scan modes are
defined symbolically in <code class="docutils literal notranslate"><span class="pre">Ip330.h</span></code>. The most commonly used mode is
<code class="docutils literal notranslate"><span class="pre">burstContinuous</span></code>, which digitizes all channels from firstChan to
lastChan at 15 microseconds per channel, and then repeats this at an
interval controlled by <code class="docutils literal notranslate"><span class="pre">setMicroSecondsPerScan()</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">setTrigger()</span></code> sets the direction of the external trigger signal on
the IP330 (input or output). The trigger directions are defined
symbolically in <code class="docutils literal notranslate"><span class="pre">Ip330.h</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">setMicroSecondsPerScan()</span></code> sets the number of microseconds per scan
loop of the IP330. This time is only applicable when the scanMode is
<code class="docutils literal notranslate"><span class="pre">burstContinuous</span></code>, <code class="docutils literal notranslate"><span class="pre">uniformContinuous</span></code>, or <code class="docutils literal notranslate"><span class="pre">uniformSingle</span></code>.
This time will be the time between interrupts. It is automatically
corrected for the 15 microsecond per channel conversion time of the
IP330. The minimum value is equal to <code class="docutils literal notranslate"><span class="pre">15*(lastChan-firstChan+1)</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">getMicroSecondsPerScan()</span></code> returns the number of microseconds per
scan loop of the IP330. This value may not equal the requested time
either because the requested time was too short or too long, or
because of the granularity of the IP330 timer.</li>
<li><code class="docutils literal notranslate"><span class="pre">setSecondsBetweenCalibrate()</span></code> When secondsBetweenCalibrate is
given a value<ul>
<li>greater than zero, then all channels are calibrated every
secondsBetweenCalibrate seconds.</li>
<li>equal to zero, then all channels are calibrated once.</li>
<li>less than zero then no calibration is done. In addition
getCorrectedValue and correctValue both return the raw rather than
converted value.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">registerCallback()</span></code> This function is called by
application-specific classes to register their interrupt functions
with Ip330. Ip330 will call the registered function every time an
interrupt occurs, passing the <code class="docutils literal notranslate"><span class="pre">pvt</span></code> pointer, and a pointer to the
new data. The <code class="docutils literal notranslate"><span class="pre">pvt</span></code> pointer is typically a pointer to the
application class object. The Ip330 interrupt routine does the
following:<ul>
<li>Saves the floating point context so application interrupt
functions can do floating point operations.</li>
<li>Copies the data from the mailBox registers to a local buffer.</li>
<li>Calls the interrupt function in each registered application class,
passing the <code class="docutils literal notranslate"><span class="pre">pvt</span></code> pointer, and a pointer to the local copy of
the data.</li>
<li>Restores the floating point context.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ip330-configuration">
<h4>Ip330 configuration<a class="headerlink" href="#ip330-configuration" title="Permalink to this headline">¶</a></h4>
<p>The Ip330 is configured by calling the following functions from the
vxWorks startup file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>extern &quot;C&quot; Ip330 *initIp330(
    const char *moduleName, const char *carrierName, const char *siteName,
    const char *typeString, const char *rangeString,
    int firstChan, int lastChan,
    int maxClients, int intVec)

# function return value  = pointer to the Ip330 object, needed by configIp330
#                          and to initialize the application-specific classes
# moduleName  = name to give this module
# carrierName = name of IPAC carrier from initIpacCarrier
# siteName    = name of IP site, e.g. &quot;IP_a&quot;
# typeString  = &quot;D&quot; or &quot;S&quot; for differential or single-ended
# rangeString = &quot;-5to5&quot;,&quot;-10to10&quot;,&quot;0to5&quot;, or &quot;0to10&quot;
#               This value must match hardware setting selected with DIP switches
# firstChan   = first channel to be digitized.  This must be in the range:
#               0 to 31 (single-ended)
#               0 to 15 (differential)
# lastChan    = last channel to be digitized
# maxClients =  Maximum number of Ip330 tasks which will attach to this
#               Ip330 module.  For example Ip330Scan, Ip330Sweep, etc.  This
#               does not refer to the number of EPICS clients.  A value of
#               10 should certainly be safe.
# intVec        Interrupt vector

extern &quot;C&quot; int configIp330(
    Ip330 *pIp330,
    scanModeType scanMode, const char *triggerString,
    int microSecondsPerScan, int secondsBetweenCalibrate)

# pIp330      = pointer to the Ip330 object, returned by initIp330 above
# scanMode    = scan mode:
#               0 = disable
#               1 = uniformContinuous
#               2 = uniformSingle
#               3 = burstContinuous (normally recommended)
#               4 = burstSingle
#               5 = convertOnExternalTriggerOnly
# triggerString = &quot;Input&quot; or &quot;Output&quot;. Selects the direction of the external
#               trigger signal.
# microSecondsPerScan = repeat interval to digitize all channels
#               The minimum theoretical time is 15 microseconds times the
#               number of channels, but a practical limit is probably 100
#               microseconds.  Larger values reduce CPU usage, but decrease
#               the number of callbacks per second to the application classes.
#               This will reduce the number of measurement averages in the
#               ip330Scan class,  increase the granularity in the time per
#               point for the ip330Sweep class, and decrease the number of
#               feedback cycles per second for the ip330PID class.
# secondsBetweenCalibrate = number of seconds between calibration cycles.
#               If zero then there will be no periodic calibration, but
#               one calibration will still be done at initialization.
#               If less than zero then no calibration is done.
#               NOTE: setGain() also causes a calibration.
</pre></div>
</div>
<p>Note that the reason for having <code class="docutils literal notranslate"><span class="pre">configIp330</span></code>, rather than just
<code class="docutils literal notranslate"><span class="pre">initIp330</span></code> is simply that there are more than 10 configurable
parameters, but vxWorks only allows 10 arguments to be passed to
functions which are called from the shell.</p>
</div>
<div class="section" id="ip330-hardware-setup">
<h4>IP330 Hardware setup<a class="headerlink" href="#ip330-hardware-setup" title="Permalink to this headline">¶</a></h4>
<p>The DIP Switch Settings column correspond to the value of switches 1 -
10. A value of 1011000010 corresponds to switches 1,3,4,9 on and
2,5,6,7,8,10 off.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ADC Range  DIP Switch     {GAIN}        {FULL VALUE}    {LOW VALUE}

-5to5      1011000010        0               5              -5
-5to5      1011000010        1               2.5            -2.5
-5to5      1011000010        2               1.25           -1.25
-5to5      1011000010        3               0.625          -0.625
-10to10    0100110010        0              10             -10
-10to10    0100110010        1               5              -5
-10to10    0100110010        2               2.5            -2.5
-10to10    0100110010        3               1.25           -1.25
0to5       1010100100        0               5               0
0to5       1010100100        1               2.5             0
0to5       1010100100        2               1.25            0
0to5       1010100100        3               0.625           0
0to10      1011001000        0              10               0
0to10      1011001000        1               5               0
0to10      1011001000        2               2.5             0
0to10      1011001000        3               1.25            0
</pre></div>
</div>
</div>
</div>
<div class="section" id="ip330config-server">
<h3><a class="toc-backref" href="#id7">Ip330Config Server</a><a class="headerlink" href="#ip330config-server" title="Permalink to this headline">¶</a></h3>
<p>A server and device support are provided to dynamically change
configuration values. Currently this only provides support for changing
setSecondsBetweenCalibrate.</p>
<div class="section" id="ip330config-server-configuration">
<h4>Ip330Config server configuration<a class="headerlink" href="#ip330config-server-configuration" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>extern &quot;C&quot; int initIp330Config(
    Ip330 *pIp330, const char *serverName, int queueSize)
# pIp330     = pointer returned by initIp330 above
# serverName = name to give this server.  Must match the INP parm field in
#              EPICS records
# queueSize  = size of output queue for MPF. Make this the maximum number
#              of records attached to this server.
</pre></div>
</div>
</div>
<div class="section" id="ip330config-epics-device-support">
<h4>Ip330Config EPICS Device Support<a class="headerlink" href="#ip330config-epics-device-support" title="Permalink to this headline">¶</a></h4>
<p>The current device support is for a longout record. It sends an
Int32Messages with the following info:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cmd</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">value</span></code></li>
</ul>
<p>Server returns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">status</span></code> - 0 means success;</li>
</ul>
<p>Standard output record type format is for longout records</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>field(DTYP,&quot;ip330Config&quot;)

field(OUT,&quot;#C{card} S{signal} @{servername},{cmd}
card   =       The location of the server
signal =       Not currently used. Just make the value 0
servername     Must match the serverName specified with initIp330Config
cmd        Default is 0,which for now is the only valid value.

field(VAL)     When the record is processed the value of the VAL field
               is setSecondsBetweenCalibrate. See above for meaning.
</pre></div>
</div>
<p>A typical use is to have a passive longout record. If the VAL field is
0, then each time the record is processed calibration will be performed.</p>
</div>
</div>
<div class="section" id="class-ip330scan">
<h3><a class="toc-backref" href="#id8">Class Ip330Scan</a><a class="headerlink" href="#class-ip330scan" title="Permalink to this headline">¶</a></h3>
<p>This class provides the functions of an averaging A/D converter.
Together with class Ip330 it provides the same functionality as
Ip330ScanApp in previous releases of MPF.</p>
<div class="section" id="ip330scan-public-interface">
<h4>Ip330Scan public interface<a class="headerlink" href="#ip330scan-public-interface" title="Permalink to this headline">¶</a></h4>
<p>This is the public interface of the Ip330Scan class:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class Ip330Scan
{
public:
    Ip330Scan(Ip330 *pIp330, int firstChan, int lastChan);
    int getValue(int channel);
    int setGain(int gain,int channel);
</pre></div>
</div>
<p>Brief description of these functions:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Ip330Scan</span></code>();
<code class="docutils literal notranslate"><span class="pre">getValue()</span></code> returns the averaged A/D value for a channel. This
value is corrected for slope and offset using the calibration data.
This is the value returned to EPICS by Ip330ScanServer.</li>
<li><code class="docutils literal notranslate"><span class="pre">setGain()</span></code> sets the gain for this channel. See
<code class="docutils literal notranslate"><span class="pre">Ip330::setGain()</span></code> for more information.</li>
</ul>
</div>
<div class="section" id="ip330scan-configuration">
<h4>Ip330Scan configuration<a class="headerlink" href="#ip330scan-configuration" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>extern &quot;C&quot; int initIp330Scan(
    Ip330 *pIp330, const char *serverName, int firstChan, int lastChan, int queueSize)
# pIp330     = pointer returned by initIp330 above
# serverName = name to give this server.  Must match the INP parm field in
#              EPICS records
# firstChan  = first channel to be used by Ip330Scan.  This must be in the
#              range firstChan to lastChan specified in initIp330
# lastChan   = last channel to be used by Ip330Scan.  This must be in the range
#              firstChan to lastChan specified in initIp330
# queueSize  = size of output queue for MPF. Make this the maximum number
#              of ai records attached to this server.
</pre></div>
</div>
<p>Note that the “millisecondsToAverage” argument which was present in
releases prior to 1.6 has been removed because the averaging algorithm
has changed.</p>
</div>
<div class="section" id="ip330scan-epics-device-support">
<h4>Ip330Scan EPICS Device Support<a class="headerlink" href="#ip330scan-epics-device-support" title="Permalink to this headline">¶</a></h4>
<p>Device support sends Int32Messages with the following info:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">address</span></code> - channel</li>
<li><code class="docutils literal notranslate"><span class="pre">value</span></code> - gain</li>
</ul>
<p>Server returns:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">value</span></code> as 32 bit unsigned integer from 0 to 0xffff</li>
<li><code class="docutils literal notranslate"><span class="pre">status</span></code> 0 means success;</li>
</ul>
<p>Note that sending the value returned by the server is the average from
the time the previous message was sent until this message was sent.&nbsp; In
other words, sending a message returns the current average and resets
the average (sum and counter).</p>
<p>Standard input record type format is for ai records</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>field(SCAN,&quot;1 second&quot;)

field(DTYP,&quot;ip330Scan&quot;)

field(INP,&quot;#C{card} S{signal} @{servername},{gain}
card   =       The location of the server
signal =       The input channel of the ip330ADC
               Differential inputs 0 - 15 are valid
               Single ended inputs 0 - 31 are valid
servername     Must match the serverName specified with initIp330Scan
gain           Optional. If given must be 0,1,2,or 3. Default is 0.

field(EGUF,&quot;{FULL VALUE}&quot;)
{FULL VALUE} = See table under class Ip330.

field(EGUL,&quot;{LOW VALUE}&quot;)
{LOW VALUE} = See table under class Ip330.

field(LINR,&quot;LINEAR&quot;)
Mandatory
</pre></div>
</div>
</div>
</div>
<div class="section" id="restrictions-on-scan-timing">
<h3><a class="toc-backref" href="#id9">Restrictions on Scan Timing</a><a class="headerlink" href="#restrictions-on-scan-timing" title="Permalink to this headline">¶</a></h3>
<p>In an earlier release of this package (1.0) each of the
application-specific classes (Ip330Scan, Ip330Sweep, Ip330PID) had a
function to control the scan rate of the Ip330. However, there is only a
single interval timer in the IP330 hardware, and so if one class changed
the scan rate it would change the scan rate for all of the other
classes. This interaction was undesirable, and so the behavior was
changed, starting with release 1.01. The value of
<code class="docutils literal notranslate"><span class="pre">microSecondsPerScan</span></code> specified in <code class="docutils literal notranslate"><span class="pre">configIp330</span></code> is never changed by
any application classes. Each application class will have its callback
routine executed at this time interval. The application class will
determine what to do when it is called back. For example, in the
<code class="docutils literal notranslate"><span class="pre">ip330Sweep</span></code> class if <code class="docutils literal notranslate"><span class="pre">microSecondsPerPoint</span></code> is 1000, and
<code class="docutils literal notranslate"><span class="pre">ip330-&gt;microSecondsPerScan</span></code> is 500, then the <code class="docutils literal notranslate"><span class="pre">ip330Sweep</span></code> callback
routine returns immediately without doing anything on every other call.
This behavior eliminates any interaction between the timing for the
different application classes. The limitation is that the granularity of
the time intervals available to an application class is now limited to
the value of <code class="docutils literal notranslate"><span class="pre">microSecondsPerScan</span></code> specified in <code class="docutils literal notranslate"><span class="pre">configIp330</span></code>,
whereas previously the granularity was 8 microseconds. Thus, for
example, if <code class="docutils literal notranslate"><span class="pre">microSecondsPerScan</span></code> is 500 microseconds then the dwell
times available in the <code class="docutils literal notranslate"><span class="pre">ip330Sweep</span></code> class are limited to multiples of
500 microseconds.</p>
<hr class="docutils" />
<div class="line-block">
<div class="line">Suggestions and Comments to:</div>
<div class="line"><a class="reference external" href="mailto:rivers&#37;&#52;&#48;cars&#46;uchicago&#46;edu">Mark Rivers</a>:
(<a class="reference external" href="mailto:rivers&#37;&#52;&#48;cars&#46;uchicago&#46;edu">rivers<span>&#64;</span>cars<span>&#46;</span>uchicago<span>&#46;</span>edu</a>)</div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Mark Rivers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>